<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="BPE : Business Process Engine">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>BPE</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/spawnproc/bpe">View on GitHub</a>

          <h1 id="project_title">BPE</h1>
          <h2 id="project_tagline">Business Process Engine</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/spawnproc/bpe/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/spawnproc/bpe/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="business-process-engine" class="anchor" href="#business-process-engine"><span class="octicon octicon-link"></span></a>Business Process Engine</h1>

<h2>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>BPE is Synrc Cloud Stack Erlang Application that bring Erlang for for Enterprise.
It provides infrastructure for Workflow Definitions, Process Orchestration,
Rule Based Production Systems and Distributed Storage.</p>

<h1>
<a name="workflow-engine" class="anchor" href="#workflow-engine"><span class="octicon octicon-link"></span></a>Workflow Engine</h1>

<p>Workflow Engine -- is an Erlang/OTP application which handles process definitions,
process instances, and provides very clean API for Workplaces.</p>

<h2>
<a name="process-schema" class="anchor" href="#process-schema"><span class="octicon octicon-link"></span></a>Process Schema</h2>

<p>Before using Process Engine you need to define the set of business process
workflows of your enterprise. This could be done via Erlang terms or some DSL
that lately converted to Erlang terms. Internally BPE uses Eralng terms
workflow definition:</p>

<div class="highlight highlight-erlang"><pre><span class="nn">bpe</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span>
   <span class="nl">#process</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"Order11"</span><span class="p">,</span>
       <span class="n">flows</span><span class="o">=</span><span class="p">[</span> <span class="nl">#sequenceFlow</span><span class="p">{</span><span class="n">source</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s">"end2"</span><span class="p">},</span>
               <span class="nl">#sequenceFlow</span><span class="p">{</span><span class="n">source</span><span class="o">=</span><span class="s">"end2"</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s">"end"</span><span class="p">}],</span>
       <span class="n">tasks</span><span class="o">=</span><span class="p">[</span> <span class="nl">#userTask</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"begin"</span><span class="p">},</span>
               <span class="nl">#userTask</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"end2"</span><span class="p">},</span>
               <span class="nl">#endEvent</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"end"</span><span class="p">}],</span>
       <span class="n">task</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">beginEvent</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">endEvent</span><span class="o">=</span><span class="s">"end"</span><span class="p">},[]).</span>

</pre></div>

<p>The worklow definiton uses following persistent workflow model which is stored in KVS:</p>

<div class="highlight highlight-erlang"><pre><span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">task</span><span class="p">,</span>         <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">roles</span><span class="p">,</span> <span class="n">module</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">userTask</span><span class="p">,</span>     <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">roles</span><span class="p">,</span> <span class="n">module</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">serviceTask</span><span class="p">,</span>  <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">roles</span><span class="p">,</span> <span class="n">module</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">messageEvent</span><span class="p">,</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">payload</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">beginEvent</span> <span class="p">,</span>   <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">endEvent</span><span class="p">,</span>      <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">sequenceFlow</span><span class="p">,</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">history</span><span class="p">,</span>      <span class="p">{</span> <span class="o">?</span><span class="nv">ITERATOR</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span><span class="n">true</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">task</span> <span class="p">}).</span>
<span class="p">-</span><span class="ni">record</span><span class="p">(</span><span class="nl">process</span><span class="p">,</span>      <span class="p">{</span> <span class="o">?</span><span class="nv">ITERATOR</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span><span class="n">true</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span>
                        <span class="n">roles</span><span class="o">=</span><span class="p">[],</span> <span class="n">tasks</span><span class="o">=</span><span class="p">[],</span> <span class="n">events</span><span class="o">=</span><span class="p">[],</span> <span class="n">history</span><span class="o">=</span><span class="p">[],</span> <span class="n">flows</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">rules</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">task</span><span class="p">,</span>
                        <span class="n">beginEvent</span><span class="p">,</span> <span class="n">endEvent</span> <span class="p">}).</span>
</pre></div>

<p>Full set of BPMN 2.0 fields could be obtainer at <a href="http://www.omg.org/spec/BPMN/2.0">http://www.omg.org/spec/BPMN/2.0</a> page 3-7.</p>

<h2>
<a name="sample-session" class="anchor" href="#sample-session"><span class="octicon octicon-link"></span></a>Sample Session</h2>

<div class="highlight highlight-erlang"><pre><span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">1</span><span class="o">&gt;</span> <span class="nn">kvs</span><span class="p">:</span><span class="nf">join</span><span class="p">().</span>
<span class="nf">ok</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">rr</span><span class="p">(</span><span class="n">bpe</span><span class="p">).</span>
<span class="p">[</span><span class="n">beginEvent</span><span class="p">,</span><span class="n">container</span><span class="p">,</span><span class="n">endEvent</span><span class="p">,</span><span class="n">history</span><span class="p">,</span><span class="n">id_seq</span><span class="p">,</span><span class="n">iterator</span><span class="p">,</span>
 <span class="n">messageEvent</span><span class="p">,</span><span class="n">process</span><span class="p">,</span><span class="n">sequenceFlow</span><span class="p">,</span><span class="n">serviceTask</span><span class="p">,</span><span class="n">task</span><span class="p">,</span><span class="n">userTask</span><span class="p">]</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">2</span><span class="o">&gt;</span> <span class="nn">bpe</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="nl">#process</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"Order11"</span><span class="p">,</span>
         <span class="n">flows</span><span class="o">=</span><span class="p">[</span><span class="nl">#sequenceFlow</span><span class="p">{</span><span class="n">source</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s">"end2"</span><span class="p">},</span>
                <span class="nl">#sequenceFlow</span><span class="p">{</span><span class="n">source</span><span class="o">=</span><span class="s">"end2"</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s">"end"</span><span class="p">}],</span>
         <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="nl">#userTask</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"begin"</span><span class="p">},</span>
                <span class="nl">#userTask</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"end2"</span><span class="p">},</span>
                <span class="nl">#endEvent</span><span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s">"end"</span><span class="p">}],</span>
         <span class="n">task</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">beginEvent</span><span class="o">=</span><span class="s">"begin"</span><span class="p">,</span><span class="n">endEvent</span><span class="o">=</span><span class="s">"end"</span><span class="p">},[]).</span>
<span class="nn">bpe_proc</span><span class="p">:</span><span class="nv">Process</span> <span class="mi">39</span> <span class="n">spawned</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">12399</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="p">{</span><span class="n">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">.</span><span class="mi">12399</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">}</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">3</span><span class="o">&gt;</span> <span class="nn">gen_server</span><span class="p">:</span><span class="nf">call</span><span class="p">(</span><span class="n">pid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12399</span><span class="p">,</span><span class="mi">0</span><span class="p">),{</span><span class="n">complete</span><span class="p">}).</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">4</span><span class="o">&gt;</span> <span class="nn">gen_server</span><span class="p">:</span><span class="nf">call</span><span class="p">(</span><span class="n">pid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12399</span><span class="p">,</span><span class="mi">0</span><span class="p">),{</span><span class="n">complete</span><span class="p">}).</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">5</span><span class="o">&gt;</span> <span class="nn">gen_server</span><span class="p">:</span><span class="nf">call</span><span class="p">(</span><span class="n">pid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12399</span><span class="p">,</span><span class="mi">0</span><span class="p">),{</span><span class="n">complete</span><span class="p">}).</span>
<span class="p">(</span><span class="n">bpe</span><span class="p">@</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="mi">5</span><span class="o">&gt;</span> <span class="nn">bpe</span><span class="p">:</span><span class="nf">history</span><span class="p">(</span><span class="mi">39</span><span class="p">).</span>
<span class="p">[</span><span class="nl">#history</span><span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">container</span> <span class="o">=</span> <span class="n">feed</span><span class="p">,</span>
          <span class="n">feed_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">history</span><span class="p">,</span><span class="mi">39</span><span class="p">},</span>
          <span class="n">prev</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span><span class="n">next</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">feeds</span> <span class="o">=</span> <span class="p">[],</span><span class="n">guard</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span>
          <span class="n">etc</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Order11"</span><span class="p">,</span>
          <span class="n">task</span> <span class="o">=</span> <span class="p">{</span><span class="n">task</span><span class="p">,</span><span class="s">"end"</span><span class="p">}},</span>
 <span class="nl">#history</span><span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">container</span> <span class="o">=</span> <span class="n">feed</span><span class="p">,</span>
          <span class="n">feed_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">history</span><span class="p">,</span><span class="mi">39</span><span class="p">},</span>
          <span class="n">prev</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span><span class="n">next</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span><span class="n">feeds</span> <span class="o">=</span> <span class="p">[],</span><span class="n">guard</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span><span class="n">etc</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span>
          <span class="n">name</span> <span class="o">=</span> <span class="s">"Order11"</span><span class="p">,</span>
          <span class="n">task</span> <span class="o">=</span> <span class="p">{</span><span class="n">task</span><span class="p">,</span><span class="s">"end2"</span><span class="p">}},</span>
 <span class="nl">#history</span><span class="p">{</span><span class="n">id</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">container</span> <span class="o">=</span> <span class="n">feed</span><span class="p">,</span>
          <span class="n">feed_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">history</span><span class="p">,</span><span class="mi">39</span><span class="p">},</span>
          <span class="n">prev</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">next</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span><span class="n">feeds</span> <span class="o">=</span> <span class="p">[],</span><span class="n">guard</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span>
          <span class="n">etc</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Order11"</span><span class="p">,</span>
          <span class="n">task</span> <span class="o">=</span> <span class="p">{</span><span class="n">task</span><span class="p">,</span><span class="s">"begin"</span><span class="p">}}]</span>
</pre></div>

<h2>
<a name="process-instances" class="anchor" href="#process-instances"><span class="octicon octicon-link"></span></a>Process Instances</h2>

<p>Instantiation of process means creating persistent context of document flow.</p>

<div class="highlight highlight-erlang"><pre><span class="nf">load</span><span class="p">(</span><span class="nv">ProcName</span><span class="p">)</span>
<span class="nf">start</span><span class="p">(</span><span class="nv">Proc</span><span class="p">,</span><span class="nv">Docs</span><span class="p">)</span>
<span class="nf">amend</span><span class="p">(</span><span class="nv">Proc</span><span class="p">,</span><span class="nv">Docs</span><span class="p">)</span>
<span class="nf">complete</span><span class="p">(</span><span class="nv">Proc</span><span class="p">)</span>
<span class="nf">history</span><span class="p">(</span><span class="nv">ProcId</span><span class="p">)</span>
<span class="nf">task</span><span class="p">(</span><span class="nv">Name</span><span class="p">,</span><span class="nv">Proc</span><span class="p">)</span>
<span class="nf">doc</span><span class="p">(</span><span class="nv">Name</span><span class="p">,</span><span class="nv">Proc</span><span class="p">)</span>
<span class="nf">events</span><span class="p">(</span><span class="nv">Proc</span><span class="p">)</span>
<span class="nf">tasks</span><span class="p">(</span><span class="nv">Proc</span><span class="p">)</span>
</pre></div>

<p>Using 'tasks' API you fetch current documents attached to the given
process at particular stage. Using 'amend' API you could upload or
change document at current stage. 'push' API move current
stage documents further by workflow.</p>

<p>Let us see how we could initial 'Wire Transfer' transaction:</p>

<div class="highlight highlight-erlang"><pre><span class="nn">bpe</span><span class="p">:</span><span class="nf">load</span><span class="p">(</span><span class="s">"WireTransfer"</span><span class="p">),</span>
<span class="nv">Id</span> <span class="o">=</span> <span class="nn">bpe</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">'WireTransfer'</span><span class="p">,[]),</span>
<span class="p">[]</span> <span class="o">=</span> <span class="nn">bpe</span><span class="p">:</span><span class="nf">tasks</span><span class="p">(</span><span class="nv">Id</span><span class="p">),</span> <span class="c">% current set is empty</span>
<span class="nv">Tasks</span> <span class="o">=</span> <span class="p">[</span> <span class="nl">#'WireTranswerReq'</span><span class="p">{</span>
            <span class="n">beneficiary</span> <span class="o">=</span> <span class="nl">#agent</span><span class="p">{</span> <span class="n">bank</span><span class="o">=</span><span class="s">"SBININBB380"</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s">"Namdak Tonpa"</span><span class="p">,</span>
                                  <span class="n">account</span><span class="o">=</span><span class="s">"305820317"</span><span class="p">},</span>
            <span class="n">subsidiary</span> <span class="o">=</span> <span class="nl">#agent</span> <span class="p">{</span> <span class="n">bank</span><span class="o">=</span><span class="s">"BKTRUS33"</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="s">"Maxim Sokhatsky"</span><span class="p">,</span>
                                  <span class="n">account</span><span class="o">=</span><span class="s">"804250223"</span><span class="p">}}],</span>

<span class="nn">bpe</span><span class="p">:</span><span class="nf">amend</span><span class="p">(</span><span class="nv">Id</span><span class="p">,</span><span class="nv">Tasks</span><span class="p">),</span>
<span class="nn">bpe</span><span class="p">:</span><span class="nf">push</span><span class="p">(</span><span class="nv">Id</span><span class="p">),</span>
</pre></div>

<h2>
<a name="dializer" class="anchor" href="#dializer"><span class="octicon octicon-link"></span></a>Dializer</h2>

<p>For check API with dialyzer build with <code>rebar compile</code> and run <code>make dialyze</code>.</p>

<h2>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h2>

<ul>
<li>Maxim Sokhatsky</li>
</ul>

<p>OM A HUM</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">BPE maintained by <a href="https://github.com/spawnproc">spawnproc</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
